{"ast":null,"code":"import _classCallCheck from\"/home/kn/dev/theorie-des-jeux/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/kn/dev/theorie-des-jeux/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/kn/dev/theorie-des-jeux/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/kn/dev/theorie-des-jeux/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import ReactDOM from'react-dom';import{jsx as _jsx}from\"react/jsx-runtime\";var MatrixCell=/*#__PURE__*/function(_React$Component){_inherits(MatrixCell,_React$Component);var _super=_createSuper(MatrixCell);function MatrixCell(props){var _this;_classCallCheck(this,MatrixCell);_this=_super.call(this,props);_this.activeStyle={border:'1px solid #000',display:'block',margin:'4px 0',padding:'4px',width:'30px',textAlign:'center'};_this.defaultStyle={border:'1px solid #eee',display:'block',margin:'4px 0',padding:'4px',width:'30px',textAlign:'center'};return _this;}_createClass(MatrixCell,[{key:\"onChange\",value:function onChange(e){var oldVal=this.props.value;var val=e.target.value;var diffLen=(''+val).length-(''+oldVal).length;this.props.matrix.setCellValue(this.props.x,this.props.y,val);this.setState({value:val});this.props.matrix.moveCell(diffLen,0);}},{key:\"onClick\",value:function onClick(e){this.props.matrix.setCell(e.target.selectionStart,this.props.x,this.props.y);}},{key:\"onKeyUp\",value:function onKeyUp(e){var dy=0;var dx=0;switch(e.key){case\"ArrowUp\":dy=-1;break;case\"ArrowRight\":dx=1;break;case\"ArrowDown\":dy=1;break;case\"ArrowLeft\":dx=-1;break;default:}this.props.matrix.moveCell(dx,dy);}},{key:\"focus\",value:function focus(){var node=ReactDOM.findDOMNode(this);node.focus();var caretPos=this.props.matrix.state.caret;node.setSelectionRange(caretPos,caretPos);}},{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.active)this.focus();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){if(this.props.active)this.focus();}},{key:\"render\",value:function render(){var style=this.defaultStyle;if(this.props.active)style=this.activeStyle;return/*#__PURE__*/_jsx(\"input\",{ref:\"input\",type:\"text\",style:style,value:this.props.value,readOnly:this.props.readonly,onClick:this.onClick.bind(this),onKeyUp:this.onKeyUp.bind(this),onChange:this.onChange.bind(this)});}}]);return MatrixCell;}(React.Component);var Matrix=/*#__PURE__*/function(_React$Component2){_inherits(Matrix,_React$Component2);var _super2=_createSuper(Matrix);function Matrix(props){var _this2;_classCallCheck(this,Matrix);_this2=_super2.call(this,props);_this2.state={x:-1,y:-1,caret:0,columns:_this2.props.columns};_this2.style={overflow:'hidden',display:'inline-block',borderLeft:'2px solid #333',borderRight:'2px solid #333',padding:'0 2px',borderRadius:'4px'};return _this2;}_createClass(Matrix,[{key:\"getHeight\",value:function getHeight(){return this.state.columns[0].length;}},{key:\"getWidth\",value:function getWidth(){return this.state.columns.length;}},{key:\"getCellValue\",value:function getCellValue(x,y){if(x<0||y<0||x>this.getWidth()-1||y>this.getHeight()-1)return'';return this.state.columns[x][y];}},{key:\"setCellValue\",value:function setCellValue(x,y,val){var columns=this.state.columns;columns[x][y]=val;this.setState({columns:columns});}},{key:\"getColumn\",value:function getColumn(n){return this.state.columns[n];}},{key:\"setColumn\",value:function setColumn(n,values){var columns=this.state.columns;columns[n]=values;this.setState({columns:columns});}},{key:\"getColumns\",value:function getColumns(){return this.state.columns;}},{key:\"getRow\",value:function getRow(n){var row=new Array(this.getWidth());var columns=this.state.columns;for(var i=0;i<columns.length;i++){row[i]=columns[i][n];}return row;}},{key:\"setRow\",value:function setRow(n,values){var columns=this.state.columns;for(var i=0;i<values.length;i++){columns[i][n]=values[i];}this.setState({columns:columns});}},{key:\"getRows\",value:function getRows(){var rows=new Array(this.getHeight());for(var i=0;i<this.getHeight();i++){rows[i]=this.getRow(i);};return rows;}},{key:\"isResizeableX\",value:function isResizeableX(){var resize=this.props.resize;return!this.props.readonly&&(resize==='horizontal'||resize==='both'||resize===undefined);}},{key:\"isResizeableY\",value:function isResizeableY(){var resize=this.props.resize;return!this.props.readonly&&(resize==='vertical'||resize==='both'||resize===undefined);}},{key:\"setCell\",value:function setCell(caret,cellX,cellY){// Remove columns / rows if needed\nthis.truncate(cellX,cellY);this.setState({caret:caret,x:cellX,y:cellY});}},{key:\"moveCell\",value:function moveCell(dx,dy){var cellX=this.state.x;var caretPos;if(this.state.caret+dx>(''+this.getCellValue(cellX,this.state.y)).length){cellX++;caretPos=0;// First pos in next cell\n}else if(this.state.caret+dx<0){cellX--;caretPos=(''+this.getCellValue(cellX,this.state.y)).length;}else{caretPos=this.state.caret+dx;}var cellY=this.state.y+dy;// Negative position is not allowed\nif(cellX<0)return;if(cellY<0)return;// If outside bounds and resizing is disabled\nif(!this.isResizeableX()&&cellX>=this.getWidth())cellX=this.state.x;if(!this.isResizeableY()&&cellY>=this.getHeight())cellY=this.state.y;// Remove columns / rows if needed\nthis.truncate(cellX,cellY);// Add column / row if needed\nif(cellX>=this.getWidth()&&this.isResizeableX()){this.addColumn();}if(this.state.y+dy>=this.getHeight()&&this.isResizeableY()){this.addRow();}this.setState({caret:caretPos,x:cellX,y:cellY});}},{key:\"addRow\",value:function addRow(){var columns=this.state.columns;for(var i=0;i<columns.length;i++){columns[i].push('');};this.setState({height:this.getHeight()+1,columns:columns});}},{key:\"addColumn\",value:function addColumn(){var columns=this.state.columns;var newColumn=new Array(this.getHeight());for(var i=0;i<newColumn.length;i++){newColumn[i]='';};columns.push(newColumn);this.setState({width:this.state.width+1,columns:columns});}},{key:\"isRowEmpty\",value:function isRowEmpty(row){for(var i=0;i<this.state.columns.length;i++){var col=this.state.columns[i];if((''+col[col.length-1]).length>0){return false;}};return true;}},{key:\"isColumnEmpty\",value:function isColumnEmpty(col){var column=this.state.columns[col];for(var i=0;i<column.length;i++){if((''+column[i]).length>0)return false;};return true;}},{key:\"removeRow\",value:function removeRow(row){for(var i=0;i<this.state.columns.length;i++){this.state.columns[i].splice(row,1);};this.setState({columns:this.state.columns});}},{key:\"removeColumn\",value:function removeColumn(col){this.state.columns.splice(col,1);this.setState({columns:this.state.columns});}},{key:\"truncate\",value:function truncate(cellX,cellY){for(var x=this.getWidth()-1;x>cellX;x--){if(this.isColumnEmpty(x)&&this.isResizeableX())this.removeColumn(x);};for(var y=this.getHeight()-1;y>cellY;y--){if(this.isRowEmpty(y)&&this.isResizeableY())this.removeRow(y);};}},{key:\"render\",value:function render(){var activeCell=this.state.x*this.getHeight()+this.state.y;var currentCell=0;var columns=this.state.columns.map(function(columnValues,x){var column=columnValues.map(function(value,y){var active=currentCell===activeCell;var cell=/*#__PURE__*/_jsx(MatrixCell,{value:value,matrix:this,x:x,y:y,active:active,readonly:this.props.readonly},x+'-'+y);currentCell++;return cell;},this);var columnStyle={float:'left',padding:'2px'};var col=/*#__PURE__*/_jsx(\"div\",{style:columnStyle,children:column},x);return col;},this);return/*#__PURE__*/_jsx(\"div\",{style:this.style,children:columns});}}]);return Matrix;}(React.Component);// Matrix.propTypes = {\n//     columns: R.array,\n//     resize: React.PropTypes.oneOf(['both', 'vertical', 'horizontal', 'none']),\n//     readonly: React.PropTypes.bool\n// }\nexport default Matrix;","map":{"version":3,"sources":["/home/kn/dev/theorie-des-jeux/src/library/react-matrix.js"],"names":["React","ReactDOM","MatrixCell","props","activeStyle","border","display","margin","padding","width","textAlign","defaultStyle","e","oldVal","value","val","target","diffLen","length","matrix","setCellValue","x","y","setState","moveCell","setCell","selectionStart","dy","dx","key","node","findDOMNode","focus","caretPos","state","caret","setSelectionRange","active","style","readonly","onClick","bind","onKeyUp","onChange","Component","Matrix","columns","overflow","borderLeft","borderRight","borderRadius","getWidth","getHeight","n","values","row","Array","i","rows","getRow","resize","undefined","cellX","cellY","truncate","getCellValue","isResizeableX","isResizeableY","addColumn","addRow","push","height","newColumn","col","column","splice","isColumnEmpty","removeColumn","isRowEmpty","removeRow","activeCell","currentCell","map","columnValues","cell","columnStyle","float"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ReactDOM from 'react-dom';\n\nclass MatrixCell extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.activeStyle = {\n            border: '1px solid #000',\n            display: 'block',\n            margin: '4px 0',\n            padding: '4px',\n            width: '30px',\n            textAlign: 'center'\n        }\n\n        this.defaultStyle = {\n            border: '1px solid #eee',\n            display: 'block',\n            margin: '4px 0',\n            padding: '4px',\n            width: '30px',\n            textAlign: 'center'\n        }\n    }\n\n    onChange(e) {\n        var oldVal = this.props.value;\n        var val = e.target.value;\n        var diffLen = (''+val).length - (''+oldVal).length;\n        this.props.matrix.setCellValue(this.props.x, this.props.y, val);\n        this.setState({value: val});\n        this.props.matrix.moveCell(diffLen, 0)\n    }\n\n    onClick(e) {\n        this.props.matrix.setCell(e.target.selectionStart, this.props.x, this.props.y)\n    }\n\n    onKeyUp(e) {\n        var dy = 0;\n        var dx = 0;\n        switch(e.key) {\n            case \"ArrowUp\":\n                dy = -1;\n                break;\n            case \"ArrowRight\":\n                dx = 1;\n                break;\n            case \"ArrowDown\":\n                dy = 1;\n                break;\n            case \"ArrowLeft\":\n                dx = -1;\n                break;\n            default:\n        }\n\n        this.props.matrix.moveCell(dx, dy);\n    }\n\n    focus() {\n        var node = ReactDOM.findDOMNode(this);\n        node.focus();\n        var caretPos = this.props.matrix.state.caret;\n        node.setSelectionRange(caretPos, caretPos)\n    }\n\n    componentDidMount() {\n        if(this.props.active) this.focus()\n    }\n\n    componentDidUpdate() {\n        if(this.props.active) this.focus()\n    }\n\n    render() {\n        var style = this.defaultStyle;\n        if(this.props.active) style = this.activeStyle;\n        return (\n            <input ref=\"input\" type=\"text\" style={style} value={this.props.value} readOnly={this.props.readonly}\n                   onClick={this.onClick.bind(this)}\n                   onKeyUp={this.onKeyUp.bind(this)}\n                   onChange={this.onChange.bind(this)} />\n        );\n    }\n}\n\nclass Matrix extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            x: -1,\n            y: -1,\n            caret: 0,\n            columns: this.props.columns\n        }\n\n        this.style = {\n            overflow: 'hidden',\n            display: 'inline-block',\n            borderLeft: '2px solid #333',\n            borderRight: '2px solid #333',\n            padding: '0 2px',\n            borderRadius: '4px'\n        }\n    }\n\n    getHeight() {\n        return this.state.columns[0].length;\n    }\n\n    getWidth() {\n        return this.state.columns.length;\n    }\n\n    getCellValue(x, y) {\n        if(x < 0 || y < 0 || x > this.getWidth()-1 || y > this.getHeight()-1) return '';\n        return this.state.columns[x][y];\n    }\n\n    setCellValue(x, y, val) {\n        var columns = this.state.columns;\n        columns[x][y] = val;\n        this.setState({\n            columns: columns,\n        })\n    }\n\n    getColumn(n) {\n        return this.state.columns[n];\n    }\n\n    setColumn(n, values) {\n        var columns = this.state.columns;\n        columns[n] = values;\n        this.setState({columns: columns});\n    }\n\n    getColumns() {\n        return this.state.columns;\n    }\n\n    getRow(n) {\n        var row = new Array(this.getWidth());\n        var columns = this.state.columns;\n        for (var i = 0; i < columns.length; i++) {\n            row[i] = columns[i][n];\n        }\n\n        return row;\n    }\n\n    setRow(n, values) {\n        var columns = this.state.columns\n        for (var i = 0; i < values.length; i++) {\n            columns[i][n] = values[i];\n        }\n\n        this.setState({columns: columns});\n    }\n\n    getRows() {\n        var rows = new Array(this.getHeight());\n        for (var i = 0; i < this.getHeight(); i++) {\n            rows[i] = this.getRow(i)\n        };\n\n        return rows;\n    }\n\n    isResizeableX() {\n        var resize = this.props.resize;\n        return (!this.props.readonly && (resize === 'horizontal' || resize === 'both' || resize === undefined))\n    }\n\n    isResizeableY() {\n        var resize = this.props.resize;\n        return (!this.props.readonly && (resize === 'vertical' || resize === 'both' || resize === undefined))\n    }\n\n    setCell(caret, cellX, cellY) {\n        // Remove columns / rows if needed\n        this.truncate(cellX, cellY);\n\n        this.setState({\n            caret: caret,\n            x: cellX,\n            y: cellY,\n        });\n    }\n\n    moveCell(dx, dy) {\n        var cellX = this.state.x;\n        var caretPos;\n\n        if(this.state.caret+dx > (''+this.getCellValue(cellX, this.state.y)).length) {\n            cellX++;\n            caretPos = 0; // First pos in next cell\n        } else if(this.state.caret+dx < 0) {\n            cellX--;\n            caretPos = (''+this.getCellValue(cellX, this.state.y)).length;\n        } else {\n            caretPos = this.state.caret+dx;\n        }\n        var cellY = this.state.y+dy;\n\n        // Negative position is not allowed\n        if(cellX < 0) return;\n        if(cellY < 0) return;\n\n        // If outside bounds and resizing is disabled\n        if(!this.isResizeableX() && cellX >= this.getWidth()) cellX = this.state.x;\n        if(!this.isResizeableY() && cellY >= this.getHeight()) cellY = this.state.y;\n\n        // Remove columns / rows if needed\n        this.truncate(cellX, cellY);\n\n        // Add column / row if needed\n        if(cellX >= this.getWidth() && this.isResizeableX()) {\n            this.addColumn();\n        }\n        if(this.state.y+dy >= this.getHeight() && this.isResizeableY()) {\n            this.addRow();\n        }\n\n        this.setState({\n            caret: caretPos,\n            x: cellX,\n            y: cellY\n        })\n    }\n\n    addRow() {\n        var columns = this.state.columns;\n        for (var i = 0; i < columns.length; i++) {\n            columns[i].push('');\n        };\n        this.setState({\n            height: this.getHeight() + 1,\n            columns: columns\n        });\n    }\n\n    addColumn() {\n        var columns = this.state.columns;\n        var newColumn = new Array(this.getHeight());\n        for (var i = 0; i < newColumn.length; i++) {\n            newColumn[i] = ''\n        };\n        columns.push(newColumn);\n\n        this.setState({\n            width: this.state.width + 1,\n            columns: columns\n        })\n    }\n\n    isRowEmpty(row) {\n        for (var i = 0; i < this.state.columns.length; i++) {\n            var col = this.state.columns[i];\n            if((''+col[col.length-1]).length > 0) {\n                return false;\n            }\n        };\n\n        return true;\n    }\n\n    isColumnEmpty(col) {\n        var column = this.state.columns[col];\n        for (var i = 0; i < column.length; i++) {\n            if((''+column[i]).length > 0) return false;\n        };\n\n        return true;\n    }\n\n    removeRow(row) {\n        for (var i = 0; i < this.state.columns.length; i++) {\n            this.state.columns[i].splice(row, 1)\n        };\n        this.setState({\n            columns: this.state.columns\n        })\n    }\n\n    removeColumn(col) {\n        this.state.columns.splice(col, 1);\n        this.setState({\n            columns: this.state.columns\n        });\n    }\n\n    truncate(cellX, cellY) {\n        for (var x = this.getWidth()-1; x > cellX; x--) {\n            if(this.isColumnEmpty(x) && this.isResizeableX()) this.removeColumn(x)\n        };\n        for (var y = this.getHeight()-1; y > cellY; y--) {\n            if(this.isRowEmpty(y) && this.isResizeableY()) this.removeRow(y)\n        };\n    }\n\n    render() {\n        var activeCell = this.state.x * this.getHeight() + this.state.y;\n        var currentCell = 0;\n\n        var columns = this.state.columns.map(function(columnValues, x) {\n            var column = columnValues.map(function(value, y) {\n                var active = currentCell === activeCell;\n                var cell = <MatrixCell key={x+'-'+y} value={value} matrix={this} x={x} y={y} active={active} readonly={this.props.readonly} />\n                currentCell++;\n                return cell;\n            }, this)\n\n            var columnStyle = {\n                float: 'left',\n                padding: '2px'\n            }\n\n            var col = <div key={x} style={columnStyle}>{column}</div>\n            return col;\n\n        }, this)\n        return (\n            <div style={this.style}>\n                {columns}\n            </div>\n        );\n    }\n}\n\n// Matrix.propTypes = {\n//     columns: R.array,\n//     resize: React.PropTypes.oneOf(['both', 'vertical', 'horizontal', 'none']),\n//     readonly: React.PropTypes.bool\n// }\n\nexport default Matrix;"]},"metadata":{},"sourceType":"module"}